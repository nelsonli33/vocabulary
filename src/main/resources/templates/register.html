<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>E-mail 會員註冊</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>	
	
	<link rel="stylesheet" href="/css/basic.css" th:href="@{/css/basic.css}">
	
		
</head>
<body>
	
	<div th:replace="fragments/navbar :: navbar"></div>
	
   <div class="basic">	
	<div class="box register">
	   <div class="container">
			
				<table cellpadding="10" class="table-register">
					<tbody>
						<tr>
							<td class="use-email" colspan="2">E-mail 會員註冊</td>
						</tr>
						<tr>
							<td>姓名：</td>
							<td><input type="text" id="username"/></td>
						</tr>
						<tr>
							<td>帳號：</td>
							<td><input type="text" id="accountInput" maxlength="12" /></td>
						</tr>
						<tr>
							<td>E-mail：</td>
							<td><input type="email" id="emailInput" maxlength="50" /></td>
						</tr>
						<tr>
							<td>密碼：</td>
							<td><input type="password" id="passwordInput" maxlength="24"/></td>
						</tr>
						<tr>
							<td>確認密碼：</td>
							<td><input type="password" id="repasswordInput" maxlength="24"/></td>
						</tr>
						<tr>
							<td>性別：</td>
							<td>
								<select id="sexSelect">
									<option value>請選擇</option>
									<option value="M">男</option>
									<option value="F">女</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>年級：</td>
							<td>
								<select id="gradeSelect">
									<option value>請選擇</option>
									<option value="高三">高三</option>
									<option value="高二">高二</option>
									<option value="高一">高一</option>
									<option value="國三">國三</option>
									<option value="國二">國二</option>
									<option value="國一">國一</option>
									<option value="其他">其他</option>
								</select>
							</td>
						</tr>
						<tr>
							<td></td>
							<td><button id="btn-register" class="btn" type="button" onclick="register()" disabled>註冊</button></td>
						</tr>
					</tbody>
					
				</table>
			

				<!-- Finish Register Modal -->
				<div class="modal fade" id="finishRegisterModalCenter" tabindex="-1" role="dialog" aria-labelledby="finishExamModalCenterTitle" aria-hidden="true">
				  <div class="modal-dialog modal-dialog-centered" role="document">
				    <div class="modal-content">

				     
				      <!-- Modal body -->
				      <div class="modal-body">
				         <p>註冊成功</p>
				         <p id="timer"></p>
				      </div>

				      <!-- Model footer -->
				      <div class="modal-footer">
				        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				        <button type="button" class="btn btn-primary" >註冊</button>
				      </div>


				    </div>
				  </div>
				</div>
		  </div>
	</div>
	</div>


	<script>

			/* 1.
			 * username 限制40字
			   account 4-12    檢查帳號是否已經被註冊
			   email   50
			   password 6-24

			   2. 檢查上述欄位是否不為空
			   $('#btn-register').removeClass('disabled');
			 */
			 // $('#accountInput').on("blur", function() {

			 // 	var account_value = $(this).val();

			 // 	// 當失去聚焦的時候，裡面的值不為空就檢查
			 // 	if(account_value != '') {
			 		
			 // 		console.log(account_value);

			 // 		$.ajax({
			 // 			url: '/path/to/file',
			 // 			type: 'POST',
			 // 			data: { account : $(this).val() },
			 // 		})
			 // 		.done(function(data) {
			 // 			console.log("success");
			 // 		})
			 // 		.fail(function() {
			 // 			console.log("error");
			 // 		})

			 // 	} else {
			 // 		console.log("空字串");
			 // 	}
			 // });
	  		
	  			
	  		function register() {
	  			
	  		var User = {};
		  	User["username"] = $("#username").val();
		  	User["account"] = $("#accountInput").val();
		  	User["email"] = $("#emailInput").val();
		  	User["password"] = $("#passwordInput").val();
		  	User["sex"] = $("#sexSelect").val();
		 	User["grade"] = $("#gradeSelect").val();	
	  		console.log(User);

			$.ajax({
				url: window.location.origin+'/Users/api/newUser',
				type: 'POST',
				dataType: 'json',
				data: JSON.stringify(User),
				contentType: "application/json; charset=utf-8",
			})
			.done(function(result) {
				console.log("success");
				
				if(result == true){
					$('#finishRegisterModalCenter').modal('show');

					$('#finishRegisterModalCenter').on('shown.bs.modal',function(event) {
						var count = 3;
						window.setInterval(function(){
							$('#timer').text(count+"後即將為您導入至登入頁面");
							count -= 1;
						},1000);

						window.setTimeout( function(){
                           window.location.href="/Users/login"
                        }, 4000 );
					});
				} else {
					console.log("失敗");
				}

			})
			.fail(function() {
				console.log("error");
			})
			.always(function() {
				console.log("complete");
			});
			
		}

	</script>
</body>
</html>