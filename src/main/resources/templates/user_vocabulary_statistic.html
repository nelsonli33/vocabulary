<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>單字訓練應用</title>
	
	
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>	
	
	<style>
		body{
			background-color: #F5F5F5;
		}
		.sidenav {
			
			width: 180px;
			position: fixed;
			/*background-image: linear-gradient(to top, #c4c5c7 0%, #dcdddf 52%, #ebebeb 100%);*/
			border: 1px solid black;
			border-radius: 5px;
			box-shadow: 10px 10px 5px #aaaaaa;
			z-index: 1;
			top: 100px;
    		left: 10px;
			overflow-x: hidden;
			padding-top: 20px;
		}

		.sidenav a{
			padding: 6px 8px 6px 0px;

    		text-decoration: none;
    		font-size: 1.1rem;
    		color: #000000;
    		display: block;
		}

		.sidenav a:hover {
 		   color: #ffffff;
		}

		.nav ul a {
			color: rgba(255,255,255,.5);
		}

		.nav ul a:hover{
			color: rgba(255,255,255,.75);
		}

	
		
	
		
	</style>
</head>
<body>
	
	
	<div class="nav" th:replace="fragments/navbar_login :: navbar_login"></div>

	<main>
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-2">
					<aside>
						<div class="sidenav">
							<ul>
								<li><a href="#">單字統計資訊</a></li>
							</ul>
						</div>
					</aside>
				</div>
				
				<div class="col-sm-10">

					<div class="row mt-3">
						<div class="col-6">
							<section class="countWords">
							<div class="card shadow p-3 mb-5 round">
							  <div class="card-header">
								練習單字次數	    
							  </div>		
							  <div class="card-body">
							    <p>已經練習 <span id="vocabulary-count"></span> 個單字囉</p>
							  </div>
							</div>
							</section>
						</div>

						<div class="col-6">
							<section class="ansRatio">
								<div class="card shadow p-2 mb-5 round">
								  <div class="card-header">
								    答題比率
								  </div>
								  <div class="card-body">
								   	<p>正確率 : <span id="rightRatio"></span> </p>
								   	<p>錯誤率 : <span id="wrongRatio"></span> </p>
								  </div>
								</div>
							</section>
						</div>
					
					
					
						<div class="col-12">
							<section class="finishedWords">
								<div class="card shadow-lg p-2 mb-5 round">
								  <div class="card-body">
								    
										<table class="table table-striped">
										  <thead>
										    <tr>
										      <th scope="col">#</th>
										      <th scope="col">英文</th>
										      <th scope="col">中文</th>
										      <th scope="col">答對次數</th>
										      <th scope="col">答錯次數</th>
										    </tr>
										  </thead>
										  <tbody id="vocabulary-statistic">
										  </tbody>
										</table>

								  </div>
								</div>
							</section>
						</div>
					
					</div>
				</div>
				
			</div>
		</div>

		
		<input type="hidden" id="account" th:value="${session.currentUser.account}" th:if="${session.currentUser}">
	</main>

	<footer></footer>
	

	<script>
	$(document).ready(function(){	

		var user = {};
		user["account"] = $('#account').val();

		$.ajax({
			url: window.location.origin+'/user/vocabulary/api/getUserVocabulary',
			type: 'POST',
			dataType: 'json',
			data: JSON.stringify(user),
			cache: true,
			contentType: "application/json; charset=utf-8"
		})
		.done(function(data) {
			// <tr>
			// 	<th scope="row">1</th>
			// 	<td>Apple</td>
			// 	<td>蘋果</td>
			// 	 <td>1</td>
			//   <td>0</td>
			// 	</tr>

			var trHTML = '';
			var count = 1;
			var timeOfAnswer = 0;
			var timeOfRightAnswer = 0;
			var timeOfWrongAnswer = 0;

			$.each(data, function(i, val) {
				trHTML += '<tr><th scope=row>'+count+'</th>'+
				'<td>'+data[i].englishword+'</td>'+
				'<td>'+data[i].chineseword+'</td>'+
				'<td>'+data[i].right_num+'</td>'+
				'<td>'+data[i].wrong_num+'</td></tr>';
				
				count += 1;
				timeOfAnswer += (data[i].right_num + data[i].wrong_num);
				timeOfRightAnswer += data[i].right_num;
				timeOfWrongAnswer += data[i].wrong_num;
			});
			
			var rightRatio = (timeOfRightAnswer/timeOfAnswer) * 100;
			var wrongRatio = (timeOfWrongAnswer/timeOfAnswer) * 100;

			$('#vocabulary-statistic').append(trHTML);
			$('#vocabulary-count').append(count-1);
			$('#rightRatio').append( rightRatio.toFixed(2)+" %");
			$('#wrongRatio').append( wrongRatio.toFixed(2)+" %");
			
			console.log("success");
		})
		.fail(function() {
			console.log("error");
		})
	})
		
	</script>
	
</body>
</html>